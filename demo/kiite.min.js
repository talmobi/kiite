!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).kiite=e()}}(function(){return function e(t,n,o){function r(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return r(n||e)},l,l.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){!function(n){"use strict";var o=0,r=Math.pow(36,4),i=function(e,t){var n="000000000"+e;return n.substr(n.length-t)},s=function(){return i((Math.random()*r<<0).toString(36),4)},c=function(){return o=o<r?o:0,++o-1},a=function(){var e,t=(new Date).getTime().toString(36),n=a.fingerprint(),o=s()+s();return e=i(c().toString(36),4),"c"+t+e+n+o};a.slug=function(){var e,t=(new Date).getTime().toString(36),n=a.fingerprint().slice(0,1)+a.fingerprint().slice(-1),o=s().slice(-2);return e=c().toString(36).slice(-4),t.slice(-2)+e+n+o},a.fingerprint=function(){var t=e("os"),n=i(process.pid.toString(36),2),o=t.hostname(),r=o.length;return n+i(o.split("").reduce(function(e,t){return+e+t.charCodeAt(0)},+r+36).toString(36),2)},n.register?n.register("cuid",a):void 0!==t?t.exports=a:n.cuid=a}(this.applitude||this)},{os:void 0}],2:[function(e,t,n){!function(e,t){t()}(0,function(){"use strict";function n(e,t){var n="",o=e.data||e.json||"",i="";switch(typeof o){case"object":i=JSON.stringify(o),n="application/json";break;case"string":if(o.length>1&&("{"===o[0]||"["===o[0]))try{JSON.parse(o),console&&console.warn&&console.warn("dasu: Sending data that may be JSON as text/plain")}catch(e){}i=o,n="text/plain";break;default:i=""+o,n="text/plain"}delete(e=Object.assign({},e)).data,e.headers=Object.assign({},{"content-type":n},e.headers||{}),e.method=e.method||"GET",e.path=e.path||"/","/"!==e.path[0]&&(e.path="/"+e.path);var s={protocol:e.protocol,host:e.host,hostname:e.hostname,port:e.port,path:e.path,method:e.method,headers:e.headers};return r(s,i,function(e,n,o){e||void 0===n?t(e):(!n.getResponseHeader&&n.headers&&(n.getResponseHeader=function(e){return n.headers[e]}),n.getAllResponseHeaders&&!n.headers&&(n.headers=n.getAllResponseHeaders()),void 0===n.status?n.status=n.statusCode:n.statusCode=n.status,t(void 0,n,o))})}var o={},r=function(){throw new Error("dasu: No request implemention specified in dasu.js")};if("undefined"!=typeof window&&void 0!==window.XMLHttpRequest)r=function(e,t,n){var r=new window.XMLHttpRequest;e.protocol=e.protocol||window.location.protocol||"http",":"!==e.protocol[e.protocol.length-1]&&(e.protocol+=":"),e.hostname=e.hostname||e.host||window.location.hostname;var i=80;e.protocol&&(i=-1!==e.protocol.indexOf("https")?443:80);var s=e.hostname.toLowerCase().trim(),c=window.location.hostname.toLowerCase().trim();-1!==s.indexOf(c)&&(i=window.location.port||i),e.port=e.port||i;var a=e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")+e.path;o.debug&&console.log("dasu: url ["+a+"]"),r.open(e.method,a,!0),r.onload=function(){n(null,r,r.responseText)},r.onerror=function(){n(r.responseText||"dasu.js XMLHttpRequest error")};for(var u=Object.keys(e.headers),l=0;l<u.length;l++){var f=u[l],d=e.headers[f];r.setRequestHeader(f,d)}return r.send(t),{abort:function(){r.abort()}}};else{var i=e,s=i("http"),c=i("https");r=function(e,t,n){(e=e||{}).hostname=e.hostname||e.host,e.protocol=e.protocol||"http";var o=s;e.protocol&&-1!==e.protocol.indexOf("https")&&(o=c),":"!==e.protocol[e.protocol.length-1]&&(e.protocol+=":");var r=o.request(e,function(e){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){n(null,e,t)})});return r.on("error",function(e){n(e)}),r.write(t),r.end(),{abort:function(){r.abort()}}}}o.xhr=function(e,t){n(e,function(e,n,o){t(e,o)})},o.req=n,t.exports=o})},{}],3:[function(e,t,n){"use strict";var o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(e){o[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,c=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),a=1;a<arguments.length;a++){n=Object(arguments[a]);for(var u in n)r.call(n,u)&&(c[u]=n[u]);if(o){s=o(n);for(var l=0;l<s.length;l++)i.call(n,s[l])&&(c[s[l]]=n[s[l]])}}return c}},{}],4:[function(e,t,n){"use strict";t.exports=function(){var e={},t={};return e.on=function(e,n){var o=t[e];return o||(o=t[e]=[]),o.push(n),function(){var o=t[e],r=o.indexOf(n);if(r>=0)return o.splice(r,1)}},e.once=function(t,n){var o=e.on(t,function(e){o(),n(e)})},e.emit=function(e,n){var o=t[e];if(o)for(var r=0;r<o.length;++r)o[r](n)},e.removeListeners=function(e){e?delete e[e]:Object.keys(t).forEach(function(e){delete t[e]})},e.listeners=function(e){if(e)return t[e];var n=[];return Object.keys(t).forEach(function(e){var o=t[e];n.concat(o)}),n},e}},{}],5:[function(e,t,n){"use strict";Object.assign=e("object-assign");var o=e("./kiite.js"),r=e("./kiite-client.js");o.connect=r,t.exports=o},{"./kiite-client.js":6,"./kiite.js":7,"object-assign":3}],6:[function(e,t,n){"use strict";function o(){}function r(){}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("dasu").req,c=e("./ee.js");t.exports=function(e){function t(e,t){var n=t||{};return Object.keys(e).forEach(function(t){null==n[t]&&(n[t]=e[t])}),n}function n(){var n=t(e);n.data={ID:f,evt:"messages",messages:p},p=[],o(),s(n,function(e,t,n){e?o():200===t.status?o():o(t.status)})}function a(){if(!g){var n=t(e);n.data={ID:f,evt:"longpoll"},o(),s(n,function(e,t,n){if(e)r(),d.emit("disconnect"),d.emit("disconnected"),r(),f=void 0,setTimeout(function(){u()},1e3);else if(200===t.status){var i=JSON.parse(n);switch(o(i.evt),i.evt){case"renew":a();break;case"messages":o(i.messages.length),i.messages.forEach(function(e){d.emit(e.evt,e.data)}),a();break;default:a()}}else{switch(o(t.status),t.status){case 444:d.emit("disconnect"),d.emit("disconnected"),r()}f=void 0,setTimeout(function(){u()},1e3)}})}}function u(){if(f=void 0,!g){var n=t(e);n.data={evt:"connect"},o(),s(n,function(e,t,n){if(e)r(),function(){y+=150;var e=2e3,t=!1;"object"===("undefined"==typeof document?"undefined":i(document))&&(t=!!(document.hidden||document.msHidden||document.webkitHidden)),t&&(e=5e3),y>e&&(y=e)}(),setTimeout(function(){u()},y);else if(200===t.status){var s=JSON.parse(n);"connected"===s.evt&&s.ID&&s.ID.length>5?(o(),f=s.ID,d.emit("connect"),d.emit("connected"),r(),a()):(o(),o())}})}}e=e||{};var l,f,d=c(),p=[],h=16,m=100,v=Date.now(),g=!1,w={on:d.on,emit:function(e,t){p.push({evt:e,data:t}),clearTimeout(l),p.length>0&&(Date.now()-v>m?(n(),v=Date.now()):l=setTimeout(function(){n(),v=Date.now()},h))},clients:{},close:function(){g=!0,function(){var n=t(e);n.data={ID:f,evt:"disconnect"},o(),s(n,function(e,t,n){})}()}};if("object"!==(void 0===e?"undefined":i(e))){throw new Error('kiite-client connect options must be of type "object"\neg: io({ host: "localhost", port: 3000 })\ndefault to window.location.hostname and window.location.port\nor localhost:80\n')}if("object"===("undefined"==typeof window?"undefined":i(window))){var b;"object"===i(window.location)&&(b=window.location),e.host=e.host||b.hostname||"localhost",e.port=e.port||b.port||80}e.path="/kiite.io",e.method="POST",u();var y=1500;return w}},{"./ee.js":4,dasu:2}],7:[function(e,t,n){"use strict";function o(){}var r=e("./ee.js"),i=e("cuid"),s=25e3,c=3e4;t.exports=function(e){function t(e,t,n){o();Object.keys(f.clients).forEach(function(r){if(r!==n){var i=f.clients[r];i.buffer.push({evt:e,data:t}),a(i)}else o()})}function n(e,t){e.statusCode=200,e.write(JSON.stringify(t)),e.end()}function a(e){if(e.buffer.length>0&&e.longpollResponse){var t=e.buffer;e.buffer=[],o((t.length,e.ID)),clearTimeout(e.longpollResponseTimeout),n(e.longpollResponse,{evt:"messages",messages:t}),delete e.longpollResponse}}function u(e,t){clearTimeout(e.DCTimeout),e.DCTimeout=setTimeout(function(){e.longpollResponse&&(e.longpollResponse.statusCode=444,e.longpollResponse.write("444 Disconnected by server."),e.longpollResponse.end()),clearTimeout(e.longpollResponseTimeout),o(e.ID),f.clientsConnected=--d,delete f.clients[e.ID],e.socket.emit("disconnect")},t||c)}!function(e){if("function"==typeof e)throw new Error('You are probably trying to attach kiite.io to an expressmiddleware function. Pass in a http.Server instance.\n\n  example: \n  var app = require( "express" )()\n  var srv = require( "http" ).createServer( app )\n  var kiite = require( "kiite" )( srv )\n');var c=e.listeners("request").slice(0);e.removeAllListeners("request"),e.on("request",function(p,h){if(0===p.url.indexOf("/kiite.io"))if("OPTIONS"===p.method){var m={};m["Access-Control-Allow-Origin"]="*",m["Access-Control-Allow-Methods"]="POST, GET, PUT, DELETE, OPTIONS",m["Access-Control-Allow-Credentials"]=!1,m["Access-Control-Max-Age"]="86400",m["Access-Control-Allow-Headers"]="X-Requested-With, X-HTTP-Method-Override, Content-Type, Accept",h.writeHead(200,m),h.end()}else h.setHeader("Access-Control-Allow-Origin","*"),function(e,c){o(e.method);var p=0,h=[];e.on("error",function(e){console.error(e.stack)}),e.on("data",function(e){p+=e.length,h.push(e)}),e.on("end",function(){h=Buffer.concat(h).toString("utf8"),function(e,c,p){try{var h=JSON.parse(p),m=e.connection.remoteAddress,v=e.headers["user-agent"],g=h.ID;o();var w;if("string"==typeof g?w=f.clients[h.ID]:o(),w)switch(w.ip!==m&&o(),w.ua!==v&&o(),u(w),e.on("close",function(){o(),"longpoll"===h.evt&&u(w,1500)}),o(h.evt),w.last_message_time=Date.now(),h.evt){case"disconnect":o(),u(w,1);break;case"longpoll":if(w.longpollResponse)throw new Error("duplicate longpolls received from the same client");clearTimeout(w.longpollResponseTimeout),w.longpollResponse=c,w.longpollResponseTimeout=setTimeout(function(){o(),n(w.longpollResponse,{evt:"renew"}),delete w.longpollResponse},s),a(w);break;case"messages":!function(e,t,n){t.statusCode=200,t.end();for(var o=0;o<n.length;++o)e.socket.emit(n[o].evt,n[o].data)}(w,c,h.messages);break;default:o(h.evt),o(),c.statusCode=404,c.end()}else if("connect"===h.evt){g=i(),o(),o(),u(w={ID:g,ip:m,ua:v,last_message_time:Date.now(),buffer:[],request:e}),f.clients[g]=w,n(c,{evt:"connected",ID:g});var b=r();w.socket=b;var y={ID:w.ID,on:b.on,emit:function(e,t){!function(e,t,n){e.buffer.push({evt:t,data:n}),a(e)}(w,e,t)},broadcast:function(e,n){t(e,n,w.ID)},request:e};f.clientsConnected=++d,l.emit("connect",y),l.emit("connection",y)}else o(),o(),c.statusCode=404,c.end()}catch(e){console.error(e.stack),o(),c.statusCode=400,c.write("400 Bad Request"),c.end()}}(e,c,h)})}(p,h);else for(var v=0;v<c.length;++v)c[v].call(e,p,h)})}(e);var l=r(),f={on:l.on,emit:function(e,n){t(e,n)},clients:{}},d=0;return f}},{"./ee.js":4,cuid:1}]},{},[5])(5)});